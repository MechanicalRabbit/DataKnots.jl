<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Optimal Layouts · QueryCombinators.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>QueryCombinators.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">QueryCombinators.jl Documentation</a></li><li><a class="toctext" href="../reference.html">API Reference</a></li><li><a class="toctext" href="index.html">Test Suite</a></li><li class="current"><a class="toctext" href="layouts.html">Optimal Layouts</a><ul class="internal"></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href="layouts.html">Optimal Layouts</a></li></ul><a class="edit-page" href="https://github.com/rbt-lang/QueryCombinators.jl/blob/master/test/layouts.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Optimal Layouts</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Optimal-Layouts-1" href="#Optimal-Layouts-1">Optimal Layouts</a></h1><p>To represent complex structures on a fixed width screen, we can use a source code layout engine.</p><pre><code class="language-julia">using QueryCombinators.Layouts</code></pre><p>For example, let us represent a simple tree structure.</p><pre><code class="language-julia">struct Node
    name::Symbol
    arms::Vector{Node}
end

Node(name) = Node(name, [])

tree =
    Node(:a, [Node(:an, [Node(:anchor, [Node(:anchorage), Node(:anchorite)]),
                           Node(:anchovy),
                           Node(:antic, [Node(:anticipation)])]),
               Node(:arc, [Node(:arch, [Node(:archduke), Node(:archer)])]),
               Node(:awl)])
#-&gt; Main.layouts.md.Node(:a, Main.layouts.md.Node[ … ])</code></pre><p>We override the function <code>Layouts.tile()</code> and use <code>Layouts.literal()</code> with combinators <code>*</code> (horizontal composition), <code>/</code> (vertical composition), and <code>|</code> (choice) to generate the layout expression.</p><pre><code class="language-julia">function Layouts.tile(tree::Node)
    if isempty(tree.arms)
        return Layouts.literal(&quot;Node($(repr(tree.name)))&quot;)
    end
    arm_lts = [Layouts.tile(arm) for arm in tree.arms]
    v_lt = h_lt = nothing
    for (k, arm_lt) in enumerate(arm_lts)
        if k == 1
            v_lt = arm_lt
            h_lt = Layouts.nobreaks(arm_lt)
        else
            v_lt = v_lt * Layouts.literal(&quot;,&quot;) / arm_lt
            h_lt = h_lt * Layouts.literal(&quot;, &quot;) * Layouts.nobreaks(arm_lt)
        end
    end
    return Layouts.literal(&quot;Node($(repr(tree.name)), [&quot;) *
           (v_lt | h_lt) *
           Layouts.literal(&quot;])&quot;)
end</code></pre><p>Now we can use function <code>pretty_print()</code> to render a nicely formatted representation of the tree.</p><pre><code class="language-julia">pretty_print(STDOUT, tree)
#=&gt;
Node(:a, [Node(:an, [Node(:anchor, [Node(:anchorage), Node(:anchorite)]),
                     Node(:anchovy),
                     Node(:antic, [Node(:anticipation)])]),
          Node(:arc, [Node(:arch, [Node(:archduke), Node(:archer)])]),
          Node(:awl)])
=#</code></pre><p>We can control the width of the output.</p><pre><code class="language-julia">pretty_print(IOContext(STDOUT, :displaysize =&gt; (24, 60)), tree)
#=&gt;
Node(:a, [Node(:an, [Node(:anchor, [Node(:anchorage),
                                    Node(:anchorite)]),
                     Node(:anchovy),
                     Node(:antic, [Node(:anticipation)])]),
          Node(:arc, [Node(:arch, [Node(:archduke),
                                   Node(:archer)])]),
          Node(:awl)])
=#</code></pre><p>We can easily display the original and the optimized layouts.</p><pre><code class="language-julia">Layouts.tile(tree)
#=&gt;
literal(&quot;Node(:a, [&quot;)
* (literal(&quot;Node(:an, [&quot;)
   * (literal(&quot;Node(:anchor, [&quot;)
   ⋮
=#

Layouts.best(Layouts.fit(STDOUT, Layouts.tile(tree)))
#=&gt;
literal(&quot;Node(:a, [&quot;)
* (literal(&quot;Node(:an, [&quot;)
   * (literal(&quot;Node(:anchor, [Node(:anchorage), Node(:anchorite)]),&quot;)
   ⋮
=#</code></pre><p>For some built-in data structures, automatic layout is already provided.</p><pre><code class="language-julia">data = [
    (name = &quot;RICHARD A&quot;, position = &quot;FIREFIGHTER&quot;, salary = 90018),
    (name = &quot;DEBORAH A&quot;, position = &quot;POLICE OFFICER&quot;, salary = 86520),
    (name = &quot;KATHERINE A&quot;, position = &quot;PERSONAL COMPUTER OPERATOR II&quot;, salary = 60780)
]

pretty_print(data)
#=&gt;
[(name = &quot;RICHARD A&quot;, position = &quot;FIREFIGHTER&quot;, salary = 90018),
 (name = &quot;DEBORAH A&quot;, position = &quot;POLICE OFFICER&quot;, salary = 86520),
 (name = &quot;KATHERINE A&quot;,
  position = &quot;PERSONAL COMPUTER OPERATOR II&quot;,
  salary = 60780)]
=#</code></pre><p>Finally, we can format and print Julia expressions.</p><pre><code class="language-julia">Q = :(
    Employee
    &gt;&gt; ThenFilter(Department &gt;&gt; Name .== &quot;POLICE&quot;)
    &gt;&gt; ThenSort(Salary &gt;&gt; Desc)
    &gt;&gt; ThenSelect(Name, Position, Salary)
    &gt;&gt; ThenTake(10)
)

print_code(Q)
#=&gt;
Employee
&gt;&gt; ThenFilter(Department &gt;&gt; Name .== &quot;POLICE&quot;)
&gt;&gt; ThenSort(Salary &gt;&gt; Desc)
&gt;&gt; ThenSelect(Name, Position, Salary)
&gt;&gt; ThenTake(10)
=#</code></pre><footer><hr/><a class="previous" href="index.html"><span class="direction">Previous</span><span class="title">Test Suite</span></a><a class="next" href="planar.html"><span class="direction">Next</span><span class="title">Planar Vectors</span></a></footer></article></body></html>
