<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Query Algebra · DataKnots.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>DataKnots.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">DataKnots.jl</a></li><li><a class="toctext" href="../reference.html">API Reference</a></li><li><a class="toctext" href="index.html">Test Suite</a></li><li class="current"><a class="toctext" href="combinators.html">Query Algebra</a><ul class="internal"></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href="combinators.html">Query Algebra</a></li></ul><a class="edit-page" href="https://github.com/rbt-lang/DataKnots.jl/blob/master/test/combinators.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Query Algebra</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Query-Algebra-1" href="#Query-Algebra-1">Query Algebra</a></h1><pre><code class="language-julia">using DataKnots
using DataKnots.Combinators

F = (it .+ 4) &gt;&gt; (it .* 6)
#-&gt; (it .+ 4) &gt;&gt; it .* 6

query(3, F)
#=&gt;
│ DataKnot │
├──────────┤
│       42 │
=#

prepare(DataKnot(3) &gt;&gt; F)
#=&gt;
chain_of(lift_block([3]),
         in_block(chain_of(tuple_of([], [as_block(), lift_block([4])]),
                           lift_to_block_tuple(+))),
         flat_block(),
         in_block(chain_of(tuple_of([], [as_block(), lift_block([6])]),
                           lift_to_block_tuple(*))),
         flat_block())
=#

usedb!(
    @VectorTree (name = [String], employee = [(name = [String], salary = [Int])]) [
        &quot;POLICE&quot;    [&quot;GARRY M&quot; 260004; &quot;ANTHONY R&quot; 185364; &quot;DANA A&quot; 170112]
        &quot;FIRE&quot;      [&quot;JOSE S&quot; 202728; &quot;CHARLES S&quot; 197736]
    ])
#=&gt;
  │ DataKnot                                                   │
  │ name    employee                                           │
──┼────────────────────────────────────────────────────────────┤
1 │ POLICE  GARRY M, 260004; ANTHONY R, 185364; DANA A, 170112 │
2 │ FIRE    JOSE S, 202728; CHARLES S, 197736                  │
=#

query(field(:name))
#=&gt;
  │ name   │
──┼────────┤
1 │ POLICE │
2 │ FIRE   │
=#

query(it.name)
#=&gt;
  │ name   │
──┼────────┤
1 │ POLICE │
2 │ FIRE   │
=#

@query name
#=&gt;
  │ name   │
──┼────────┤
1 │ POLICE │
2 │ FIRE   │
=#

query(field(:employee) &gt;&gt; field(:salary))
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 185364 │
3 │ 170112 │
4 │ 202728 │
5 │ 197736 │
=#

query(it.employee.salary)
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 185364 │
3 │ 170112 │
4 │ 202728 │
5 │ 197736 │
=#

@query employee.salary
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 185364 │
3 │ 170112 │
4 │ 202728 │
5 │ 197736 │
=#

query(count(it.employee))
#=&gt;
  │ DataKnot │
──┼──────────┤
1 │        3 │
2 │        2 │
=#

@query count(employee)
#=&gt;
  │ DataKnot │
──┼──────────┤
1 │        3 │
2 │        2 │
=#

query(count)
#=&gt;
│ DataKnot │
├──────────┤
│        2 │
=#

@query count()
#=&gt;
│ DataKnot │
├──────────┤
│        2 │
=#

query(count(it.employee) &gt;&gt; maximum)
#=&gt;
│ DataKnot │
├──────────┤
│        3 │
=#

@query count(employee).max()
#=&gt;
│ DataKnot │
├──────────┤
│        3 │
=#

query(it.employee &gt;&gt; filter(it.salary .&gt; 200000))
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

@query employee.filter(salary&gt;200000)
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

@query begin
    employee
    filter(salary&gt;200000)
end
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

query(count(it.employee) .&gt; 2)
#=&gt;
  │ DataKnot │
──┼──────────┤
1 │     true │
2 │    false │
=#

@query count(employee)&gt;2
#=&gt;
  │ DataKnot │
──┼──────────┤
1 │     true │
2 │    false │
=#

query(filter(count(it.employee) .&gt; 2))
#=&gt;
  │ DataKnot                                                   │
  │ name    employee                                           │
──┼────────────────────────────────────────────────────────────┤
1 │ POLICE  GARRY M, 260004; ANTHONY R, 185364; DANA A, 170112 │
=#

@query filter(count(employee)&gt;2)
#=&gt;
  │ DataKnot                                                   │
  │ name    employee                                           │
──┼────────────────────────────────────────────────────────────┤
1 │ POLICE  GARRY M, 260004; ANTHONY R, 185364; DANA A, 170112 │
=#

query(filter(count(it.employee) .&gt; 2) &gt;&gt; count)
#=&gt;
│ DataKnot │
├──────────┤
│        1 │
=#

@query begin
    filter(count(employee)&gt;2)
    count()
end
#=&gt;
│ DataKnot │
├──────────┤
│        1 │
=#

query(record(it.name, :size =&gt; count(it.employee)))
#=&gt;
  │ DataKnot     │
  │ name    size │
──┼──────────────┤
1 │ POLICE     3 │
2 │ FIRE       2 │
=#

@query record(name, size =&gt; count(employee))
#=&gt;
  │ DataKnot     │
  │ name    size │
──┼──────────────┤
1 │ POLICE     3 │
2 │ FIRE       2 │
=#

query(it.employee &gt;&gt; filter(it.salary .&gt; it.S),
      S=200000)
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

query(
    given(:S =&gt; maximum(it.employee.salary),
        it.employee &gt;&gt; filter(it.salary .== it.S)))
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

@query begin
    employee
    filter(salary&gt;S)
end where { S = 200000 }
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

@query given(
        S =&gt; max(employee.salary),
        employee.filter(salary==S))
#=&gt;
  │ employee        │
  │ name     salary │
──┼─────────────────┤
1 │ GARRY M  260004 │
2 │ JOSE S   202728 │
=#

query(it.employee.salary &gt;&gt; sort)
#=&gt;
  │ salary │
──┼────────┤
1 │ 170112 │
2 │ 185364 │
3 │ 197736 │
4 │ 202728 │
5 │ 260004 │
=#

@query employee.salary.sort()
#=&gt;
  │ salary │
──┼────────┤
1 │ 170112 │
2 │ 185364 │
3 │ 197736 │
4 │ 202728 │
5 │ 260004 │
=#

query(it.employee.salary &gt;&gt; desc &gt;&gt; sort)
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 202728 │
3 │ 197736 │
4 │ 185364 │
5 │ 170112 │
=#

@query employee.salary.desc().sort()
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 202728 │
3 │ 197736 │
4 │ 185364 │
5 │ 170112 │
=#

query(it.employee &gt;&gt; sort(it.salary))
#=&gt;
  │ employee          │
  │ name       salary │
──┼───────────────────┤
1 │ DANA A     170112 │
2 │ ANTHONY R  185364 │
3 │ CHARLES S  197736 │
4 │ JOSE S     202728 │
5 │ GARRY M    260004 │
=#

@query employee.sort(salary)
#=&gt;
  │ employee          │
  │ name       salary │
──┼───────────────────┤
1 │ DANA A     170112 │
2 │ ANTHONY R  185364 │
3 │ CHARLES S  197736 │
4 │ JOSE S     202728 │
5 │ GARRY M    260004 │
=#

query(it.employee &gt;&gt; sort(it.salary &gt;&gt; desc))
#=&gt;
  │ employee          │
  │ name       salary │
──┼───────────────────┤
1 │ GARRY M    260004 │
2 │ JOSE S     202728 │
3 │ CHARLES S  197736 │
4 │ ANTHONY R  185364 │
5 │ DANA A     170112 │
=#

@query employee.sort(salary.desc())
#=&gt;
  │ employee          │
  │ name       salary │
──┼───────────────────┤
1 │ GARRY M    260004 │
2 │ JOSE S     202728 │
3 │ CHARLES S  197736 │
4 │ ANTHONY R  185364 │
5 │ DANA A     170112 │
=#

query(it.employee.salary &gt;&gt; take(3))
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 185364 │
3 │ 170112 │
=#

query(it.employee.salary &gt;&gt; drop(3))
#=&gt;
  │ salary │
──┼────────┤
1 │ 202728 │
2 │ 197736 │
=#

query(it.employee.salary &gt;&gt; take(-3))
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 185364 │
=#

query(it.employee.salary &gt;&gt; drop(-3))
#=&gt;
  │ salary │
──┼────────┤
1 │ 170112 │
2 │ 202728 │
3 │ 197736 │
=#

query(it.employee.salary &gt;&gt; take(count(thedb() &gt;&gt; it.employee) .÷ 2))
#=&gt;
  │ salary │
──┼────────┤
1 │ 260004 │
2 │ 185364 │
=#

usedb!(
    @VectorTree (department = [&amp;DEPT], employee = [&amp;EMP]) [
        [1, 2]  [1, 2, 3, 4]
    ] where {
        DEPT = @VectorTree (name = [String], employee = [&amp;EMP]) [
            &quot;POLICE&quot;    [1, 2]
            &quot;FIRE&quot;      [3, 4]
        ]
        ,
        EMP = @VectorTree (name = [String], department = [&amp;DEPT], position = [String], salary = [Int]) [
            &quot;JAMES A&quot;   1   &quot;SERGEANT&quot;      110370
            &quot;MICHAEL W&quot; 1   &quot;INVESTIGATOR&quot;  63276
            &quot;STEVEN S&quot;  2   &quot;CAPTAIN&quot;       123948
            &quot;APRIL W&quot;   2   &quot;PARAMEDIC&quot;     54114
        ]
    }
)
#=&gt;
│ DataKnot                       │
│ department  employee           │
├────────────────────────────────┤
│ [1]; [2]    [1]; [2]; [3]; [4] │
=#

@query department.name
#=&gt;
  │ name   │
──┼────────┤
1 │ POLICE │
2 │ FIRE   │
=#

@query department.employee.name
#=&gt;
  │ name      │
──┼───────────┤
1 │ JAMES A   │
2 │ MICHAEL W │
3 │ STEVEN S  │
4 │ APRIL W   │
=#

@query employee.department.name
#=&gt;
  │ name   │
──┼────────┤
1 │ POLICE │
2 │ POLICE │
3 │ FIRE   │
4 │ FIRE   │
=#

@query employee.position
#=&gt;
  │ position     │
──┼──────────────┤
1 │ SERGEANT     │
2 │ INVESTIGATOR │
3 │ CAPTAIN      │
4 │ PARAMEDIC    │
=#

@query count(department)
#=&gt;
│ DataKnot │
├──────────┤
│        2 │
=#

@query max(employee.salary)
#=&gt;
│ salary │
├────────┤
│ 123948 │
=#

@query department.count(employee)
#=&gt;
  │ DataKnot │
──┼──────────┤
1 │        2 │
2 │        2 │
=#

@query max(department.count(employee))
#=&gt;
│ DataKnot │
├──────────┤
│        2 │
=#

@query employee.filter(salary&gt;100000).name
#=&gt;
  │ name     │
──┼──────────┤
1 │ JAMES A  │
2 │ STEVEN S │
=#

@query begin
    department
    filter(count(employee)&gt;=2)
    count()
end
#=&gt;
│ DataKnot │
├──────────┤
│        2 │
=#

@query department.record(name, size =&gt; count(employee))
#=&gt;
  │ DataKnot     │
  │ name    size │
──┼──────────────┤
1 │ POLICE     2 │
2 │ FIRE       2 │
=#</code></pre><footer><hr/><a class="previous" href="queries.html"><span class="direction">Previous</span><span class="title">Query Backend</span></a></footer></article></body></html>
